<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mage Knight Companion — Phone</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#c7924f;
      --muted:#9aa4b2;
      --glass: rgba(255,255,255,0.03);
      --radius:14px;
      --phone-width:380px;
    }
    * { box-sizing: border-box; }
    html,body { height:100%; margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:linear-gradient(180deg,#071028 0%, #061226 100%); color:#e6eef6; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    .phone-shell {
      width:100%;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px 12px;
    }
    .frame {
      width:var(--phone-width);
      max-width:94vw;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04));
      border-radius:28px;
      padding:12px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .topbar {
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      top:18px;
      width:var(--phone-width);
      max-width:94vw;
      text-align:center;
      pointer-events:none;
    }
    .topbar h1 { margin:0; font-size:14px; font-weight:600; color:var(--muted); pointer-events:auto; }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.015));
      border-radius: var(--radius);
      padding:12px;
      border: 1px solid rgba(255,255,255,0.03);
      box-shadow: 0 3px 12px rgba(0,0,0,0.5);
    }
    .card-header { display:flex; align-items:center; gap:10px; margin-bottom:8px; }
    .card-title { font-size:16px; margin:0; color:#fff; }
    .card-sub { font-size:12px; color:var(--muted); margin-top:2px; }
    .card-body { font-size:14px; color:#e6eef6; }
    .stat-row { display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .stat-value { font-size:28px; font-weight:700; color:var(--accent); }
    .stat-controls button {
      background:var(--glass);
      color:#eaf2ff;
      border:1px solid rgba(255,255,255,0.03);
      padding:6px 10px;
      border-radius:8px;
      margin-left:6px;
      cursor:pointer;
    }
    .stat-controls { display:flex; align-items:center; }
    .small { color:var(--muted); font-size:12px; margin-top:8px; }
    .dummy-grid { display:grid; grid-template-columns:1fr 1fr; gap:6px; margin-bottom:8px; color:#eaf2ff; }
    .controls-row { display:flex; gap:8px; justify-content:space-between; margin-top:8px; }
    .controls-row button {
      flex:1;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.04);
      background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
      color:#eaf2ff;
      cursor:pointer;
    }
    .controls-row button.primary {
      background: linear-gradient(180deg, rgba(199,146,79,0.12), rgba(199,146,79,0.08));
      border: 1px solid rgba(199,146,79,0.25);
      color: #ffdcb3;
      font-weight:600;
    }
    .volkare-text {
      width:100%;
      resize:vertical;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.03);
      background: rgba(255,255,255,0.01);
      color: #eaf2ff;
      padding:8px;
      font-size:13px;
      min-height:74px;
    }
    .footer {
      margin-top:8px;
      text-align:center;
      color:var(--muted);
      font-size:12px;
    }
    .row { display:flex; gap:8px; align-items:center; }
    .chip { background: rgba(255,255,255,0.02); padding:6px 8px; border-radius:8px; border:1px solid rgba(255,255,255,0.02); font-size:13px; color:var(--muted); }
    @media (max-width:400px) {
      :root { --phone-width:94vw; }
      .topbar { left:50%; transform:translateX(-50%); width:94vw; }
    }
  </style>
</head>
<body>
  <div class="phone-shell">
    <div class="frame" role="application" aria-label="Mage Knight Companion">
      <header class="topbar">
        <h1>Mage Knight Companion</h1>
      </header>

      <!-- Reputation -->
      <section class="card" id="reputation-card" aria-labelledby="rep-title">
        <div class="card-header">
          <div>
            <h2 id="rep-title" class="card-title">Reputation</h2>
            <div class="card-sub">Influence track</div>
          </div>
        </div>
        <div class="card-body">
          <div class="stat-row">
            <div class="row">
              <div class="chip">Faction</div>
              <div style="width:12px"></div>
              <div class="stat-value" id="reputation-value">5</div>
            </div>
            <div class="stat-controls" aria-hidden="true">
              <button id="rep-decrease">-</button>
              <button id="rep-increase">+</button>
            </div>
          </div>
          <div class="small">Use reputation for city interactions and level checks.</div>
        </div>
      </section>

      <!-- Fame -->
      <section class="card" id="fame-card" aria-labelledby="fame-title">
        <div class="card-header">
          <div>
            <h2 id="fame-title" class="card-title">Fame</h2>
            <div class="card-sub">Progress to level up</div>
          </div>
        </div>
        <div class="card-body">
          <div class="stat-row">
            <div class="stat-value" id="fame-value">0</div>
            <div class="stat-controls" aria-hidden="true">
              <button id="fame-decrease">-</button>
              <button id="fame-increase">+</button>
            </div>
          </div>
          <div class="small">Accumulate fame to reach the next level.</div>
        </div>
      </section>

      <!-- Dummy Player -->
      <section class="card" id="dummy-card" aria-labelledby="dummy-title">
        <div class="card-header">
          <div>
            <h2 id="dummy-title" class="card-title">Dummy Player</h2>
            <div class="card-sub" id="dummy-sub">Dummy</div>
          </div>
        </div>
        <div class="card-body">
          <div class="dummy-grid">
            <div>Hand: <strong id="dummy-hand">5</strong></div>
            <div>Wounds: <strong id="dummy-wounds">0</strong></div>
            <div style="grid-column:1 / -1">Last: <em id="dummy-last">Idle</em></div>
          </div>

          <div class="controls-row" role="group" aria-label="Dummy controls">
            <button id="play-1">Play 1</button>
            <button id="draw-1">Draw 1</button>
            <button id="auto-action" class="primary">Auto Action</button>
          </div>

          <div style="margin-top:8px; display:flex; gap:8px;">
            <button id="heal-1">Heal 1</button>
            <button id="reset-dummy">Reset Dummy</button>
          </div>
        </div>
      </section>

      <!-- General Volkare -->
      <section class="card" id="volkare-card" aria-labelledby="volkare-title">
        <div class="card-header">
          <div>
            <h2 id="volkare-title" class="card-title">General Volkare</h2>
            <div class="card-sub">Notes / reminders</div>
          </div>
        </div>
        <div class="card-body">
          <textarea id="volkare-text" class="volkare-text">General Volkare: Track story events or reminders here.</textarea>
          <div class="small">Save story notes or special rules for this scenario.</div>
        </div>
      </section>

      <footer class="footer">
        <small>Phone layout • Lightweight companion</small>
      </footer>
    </div>
  </div>

  <script>
    // Simple in-file state and interactions
    (function () {
      // state
      const state = {
        reputation: 5,
        fame: 0,
        dummy: {
          name: 'Dummy Player',
          hand: 5,
          wounds: 0,
          lastAction: 'Idle'
        },
        volkareNotes: 'General Volkare: Track story events or reminders here.'
      };

      // elements
      const el = {
        reputationValue: document.getElementById('reputation-value'),
        fameValue: document.getElementById('fame-value'),
        dummyHand: document.getElementById('dummy-hand'),
        dummyWounds: document.getElementById('dummy-wounds'),
        dummyLast: document.getElementById('dummy-last'),
        dummySub: document.getElementById('dummy-sub'),
        volkareText: document.getElementById('volkare-text')
      };

      // render helpers
      function renderReputation() { el.reputationValue.textContent = state.reputation; }
      function renderFame() { el.fameValue.textContent = state.fame; }
      function renderDummy() {
        el.dummyHand.textContent = state.dummy.hand;
        el.dummyWounds.textContent = state.dummy.wounds;
        el.dummyLast.textContent = state.dummy.lastAction;
        el.dummySub.textContent = state.dummy.name;
      }
      function renderVolkare() { el.volkareText.value = state.volkareNotes; }

      // clamp helper
      function clamp(n, min=0, max=999) { return Math.max(min, Math.min(max, n)); }

      // controls
      document.getElementById('rep-decrease').addEventListener('click', () => {
        state.reputation = clamp(state.reputation - 1, 0);
        renderReputation();
      });
      document.getElementById('rep-increase').addEventListener('click', () => {
        state.reputation = clamp(state.reputation + 1, 0);
        renderReputation();
      });

      document.getElementById('fame-decrease').addEventListener('click', () => {
        state.fame = clamp(state.fame - 1, 0);
        renderFame();
      });
      document.getElementById('fame-increase').addEventListener('click', () => {
        state.fame = clamp(state.fame + 1, 0);
        renderFame();
      });

      document.getElementById('play-1').addEventListener('click', () => {
        state.dummy.hand = clamp(state.dummy.hand - 1, 0);
        state.dummy.lastAction = 'Played 1 card';
        renderDummy();
      });
      document.getElementById('draw-1').addEventListener('click', () => {
        state.dummy.hand = clamp(state.dummy.hand + 1, 0);
        state.dummy.lastAction = 'Drew 1 card';
        renderDummy();
      });
      document.getElementById('heal-1').addEventListener('click', () => {
        state.dummy.wounds = clamp(state.dummy.wounds - 1, 0);
        state.dummy.lastAction = 'Healed 1 wound';
        renderDummy();
      });
      document.getElementById('reset-dummy').addEventListener('click', () => {
        state.dummy = { name: 'Dummy Player', hand: 5, wounds: 0, lastAction: 'Idle' };
        renderDummy();
      });

      // Auto action: deterministic rule
      document.getElementById('auto-action').addEventListener('click', () => {
        // rule:
        // if hand < 3 => draw 2
        // else if wounds >= 4 => skip (defensive, simulate rest)
        // else prefer to play one attack: play 1 card and take 1 wound
        if (state.dummy.hand < 3) {
          state.dummy.hand = clamp(state.dummy.hand + 2, 0);
          state.dummy.lastAction = 'Auto: Drew 2 cards';
        } else if (state.dummy.wounds >= 4) {
          state.dummy.lastAction = 'Auto: Rested (defensive)';
          // simulate healing small amount when resting
          state.dummy.wounds = clamp(state.dummy.wounds - 1, 0);
        } else {
          state.dummy.hand = clamp(state.dummy.hand - 1, 0);
          state.dummy.wounds = clamp(state.dummy.wounds + 1, 0);
          state.dummy.lastAction = 'Auto: Attacked (took 1 wound)';
        }
        renderDummy();
      });

      // notes persistence to localStorage
      const STORAGE_KEY = 'mk_companion_v1';
      function saveToStorage() {
        try {
          const payload = {
            reputation: state.reputation,
            fame: state.fame,
            dummy: state.dummy,
            volkareNotes: state.volkareNotes
          };
          localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
        } catch (e) { /* ignore storage errors */ }
      }
      function loadFromStorage() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return;
          const parsed = JSON.parse(raw);
          if (typeof parsed.reputation === 'number') state.reputation = parsed.reputation;
          if (typeof parsed.fame === 'number') state.fame = parsed.fame;
          if (parsed.dummy) state.dummy = Object.assign(state.dummy, parsed.dummy);
          if (typeof parsed.volkareNotes === 'string') state.volkareNotes = parsed.volkareNotes;
        } catch (e) { /* ignore parse errors */ }
      }

      // volkare textarea binding
      el.volkareText.addEventListener('input', (e) => {
        state.volkareNotes = e.target.value;
      });

      // autosave every 2s (lightweight)
      setInterval(saveToStorage, 2000);

      // load and initial render
      loadFromStorage();
      renderReputation();
      renderFame();
      renderDummy();
      renderVolkare();

      // quick keyboard shortcuts for desktop testing (R/F/D)
      window.addEventListener('keydown', (ev) => {
        if (ev.key === 'r') { state.reputation = clamp(state.reputation + 1); renderReputation(); }
        if (ev.key === 'f') { state.fame = clamp(state.fame + 1); renderFame(); }
        if (ev.key === 'd') { document.getElementById('auto-action').click(); }
      });
    })();
  </script>
</body>
</html>
