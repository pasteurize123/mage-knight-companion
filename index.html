<!DOCTYPE html>
<html>
<head>
  <title>Mage Knight Companion</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
    h1 { color: #333; }
    .section { margin-bottom: 30px; }
    button { margin: 5px; padding: 6px 10px; }
    .output { background: #fff; padding: 10px; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>Mage Knight Dummy Player Companion</h1>

  <div class="section">
    <h2>Fame & Reputation</h2>
    Fame: <span id="fame">0</span>
    <button onclick="changeFame(1)">+1 Fame</button>
    <button onclick="changeFame(-1)">-1 Fame</button><br><br>
    Reputation: <span id="reputation">0</span>
    <button onclick="changeReputation(1)">+1 Rep</button>
    <button onclick="changeReputation(-1)">-1 Rep</button>
  </div>

  <div class="section">
    <h2>Crystals</h2>
    ðŸ”´ Red: <span id="red">0</span>
    <button onclick="changeCrystal('red', 1)">âž•</button>
    <button onclick="changeCrystal('red', -1)">âž–</button><br>
    ðŸ”µ Blue: <span id="blue">0</span>
    <button onclick="changeCrystal('blue', 1)">âž•</button>
    <button onclick="changeCrystal('blue', -1)">âž–</button><br>
    ðŸŸ¢ Green: <span id="green">0</span>
    <button onclick="changeCrystal('green', 1)">âž•</button>
    <button onclick="changeCrystal('green', -1)">âž–</button><br>
    âšª White: <span id="white">0</span>
    <button onclick="changeCrystal('white', 1)">âž•</button>
    <button onclick="changeCrystal('white', -1)">âž–</button>
  </div>

  <div class="section">
    <h2>Dummy Deck</h2>
    <button onclick="addCard('Red')">+ Red Card</button>
    <button onclick="addCard('Blue')">+ Blue Card</button>
    <button onclick="addCard('Green')">+ Green Card</button>
    <button onclick="addCard('White')">+ White Card</button>
    <button onclick="resetDeck()">Reset Deck</button>
    <p>Cards left in deck: <span id="deck-count">16</span></p>
  </div>

  <div class="section">
    <h2>Draw Cards</h2>
    <button onclick="drawDummyCards()">Draw Dummy Cards</button>
    <div class="output">
      <p id="dummy-output">Drawn cards will appear here.</p>
    </div>
  </div>

  <div class="section">
    <h2>Discard Pile</h2>
    <div class="output">
      <p id="discard-output">Discard pile is empty.</p>
    </div>
  </div>

  <script>
    let fame = 0;
    let reputation = 0;
    let crystals = { red: 0, blue: 0, green: 0, white: 0 };
    let dummyDeck = [];
    let discardPile = [];

    function initializeDeck() {
      dummyDeck = [
        ...Array(4).fill("Red Card"),
        ...Array(4).fill("Blue Card"),
        ...Array(4).fill("Green Card"),
        ...Array(4).fill("White Card")
      ];
      discardPile = [];
      updateDeckCount();
      updateDiscardPile();
    }

    function changeFame(amount) {
      fame += amount;
      document.getElementById("fame").textContent = fame;
    }

    function changeReputation(amount) {
      reputation += amount;
      document.getElementById("reputation").textContent = reputation;
    }

    function changeCrystal(color, amount) {
      crystals[color] = Math.max(0, crystals[color] + amount);
      document.getElementById(color).textContent = crystals[color];
    }

    function addCard(color) {
      dummyDeck.push(`${color} Card`);
      updateDeckCount();
    }

    function resetDeck() {
      initializeDeck();
      document.getElementById("dummy-output").textContent = "Deck reset to 16 cards.";
    }

    function drawDummyCards() {
      let drawn = [];

      // Draw minimum 3 cards
      for (let i = 0; i < 3 && dummyDeck.length > 0; i++) {
        let index = Math.floor(Math.random() * dummyDeck.length);
        drawn.push(dummyDeck.splice(index, 1)[0]);
      }

      // Check last card and draw extra cards equal to matching crystals
      let lastCard = drawn[drawn.length - 1];
      if (lastCard) {
        let color = lastCard.split(" ")[0].toLowerCase();
        let extraDraws = crystals[color] || 0;

        for (let i = 0; i < extraDraws && dummyDeck.length > 0; i++) {
          let index = Math.floor(Math.random() * dummyDeck.length);
          drawn.push(dummyDeck.splice(index, 1)[0]);
        }
      }

      discardPile.push(...drawn);
      document.getElementById("dummy-output").textContent = `Dummy draws: ${drawn.join(", ")}`;
      updateDeckCount();
      updateDiscardPile();
    }

    function updateDeckCount() {
      document.getElementById("deck-count").textContent = dummyDeck.length;
    }

    function updateDiscardPile() {
      document.getElementById("discard-output").textContent =
        discardPile.length === 0
          ? "Discard pile is empty."
          : `Discard pile: ${discardPile.join(", ")}`;
    }

    initializeDeck();
  </script>
</body>
</html>
