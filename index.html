<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Mage Knight Companion</title>
  <style>
    :root{
      --bg:#0f1720;
      --card:#0b1220;
      --accent:#e0a200;
      --muted:#98a0b0;
      --text:#e6eef8;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
    .phone-frame{max-width:420px;margin:12px auto;border-radius:18px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.6);background:linear-gradient(180deg,#07101a,#08131b);min-height:640px;display:flex;flex-direction:column}
    .topbar{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid rgba(255,255,255,0.03)}
    .title{font-weight:600;font-size:14px}
    .icon-btn{background:transparent;border:none;color:var(--muted);font-size:18px;padding:8px;border-radius:8px}
    .content{padding:12px;display:flex;flex-direction:column;gap:12px;flex:1}
    .card{background:var(--card);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .card-header h3{margin:0;font-size:13px;color:var(--muted)}
    .rep-value,.fame-value{font-weight:700;font-size:20px;color:var(--accent)}
    .rep-bar{position:relative;height:36px;background:rgba(255,255,255,0.03);border-radius:10px;overflow:hidden;margin-bottom:10px}
    .rep-fill{position:absolute;left:0;top:0;bottom:0;background:linear-gradient(90deg,var(--accent),#ffd27a);width:30%}
    .rep-marker{position:absolute;top:0;height:100%;transform:translateX(-50%);display:flex;align-items:flex-end;padding-bottom:4px}
    .rep-marker span{font-size:11px;color:var(--muted);background:rgba(0,0,0,0.25);padding:2px 6px;border-radius:6px}
    .controls-row{display:flex;gap:8px;align-items:center}
    .controls-row button{flex:1;padding:8px 10px;border-radius:10px;border:none;background:rgba(255,255,255,0.03);color:var(--text);font-size:16px}
    .fame-controls{display:flex;flex-direction:column;gap:8px}
    .fame-step{display:flex;gap:8px;align-items:center}
    .fame-step input{width:68px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text);text-align:center}
    .fame-presets{display:flex;gap:8px}
    .fame-presets button{padding:8px;border-radius:8px;border:none;background:rgba(255,255,255,0.03);color:var(--text)}
    .level-preview{display:flex;justify-content:space-between;font-size:13px;color:var(--muted);padding-top:6px}
    .small-controls{display:flex;justify-content:space-between;padding:6px 12px}
    .small-controls button{padding:8px 12px;border-radius:8px;border:none;background:#14202a;color:var(--text)}
    .modal{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:40}
    .modal-card{background:#07131a;padding:16px;border-radius:12px;width:92%;max-width:380px;border:1px solid rgba(255,255,255,0.04)}
    .modal-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:12px}
    .modal-actions button{padding:8px 10px;border-radius:8px;border:none;background:rgba(255,255,255,0.03);color:var(--text)}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#112232;padding:8px 14px;border-radius:18px;color:var(--text);font-size:13px;border:1px solid rgba(255,255,255,0.03);z-index:50}
    /* small responsive tweaks */
    @media (max-width:380px){
      .phone-frame{margin:8px}
      .rep-bar{height:32px}
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React + ReactDOM UMD builds -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel for JSX in-browser (development only) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const DEFAULTS = {
      reputation: { value: 12, min: 0, max: 24, markers: [0, 6, 12, 18, 24] },
      fame: {
        value: 3,
        levels: [
          { threshold: 5, reward: "Level 1 Reward" },
          { threshold: 10, reward: "Level 2 Reward" },
          { threshold: 20, reward: "Level 3 Reward" }
        ]
      }
    };

    function useToast() {
      const [toast, setToast] = useState("");
      useEffect(() => {
        if (!toast) return;
        const t = setTimeout(() => setToast(""), 1600);
        return () => clearTimeout(t);
      }, [toast]);
      return [toast, setToast];
    }

    function App() {
      const [reputation, setReputation] = useState(DEFAULTS.reputation);
      const [fame, setFame] = useState(DEFAULTS.fame);
      const [history, setHistory] = useState([]);
      const [modal, setModal] = useState(null);
      const [toast, showToast] = useToast();

      function pushHistory(item) {
        setHistory(h => [...h, item].slice(-30));
      }

      function changeReputation(delta) {
        const newVal = Math.max(reputation.min, Math.min(reputation.max, reputation.value + delta));
        if (newVal === reputation.value) return;
        pushHistory({ type: "rep", before: reputation.value });
        setReputation(r => ({ ...r, value: newVal }));
        showToast(`Reputation ${newVal}`);
      }

      function changeFame(delta) {
        const newVal = Math.max(0, fame.value + delta);
        if (newVal === fame.value) return;
        pushHistory({ type: "fame", before: fame.value });
        const updated = { ...fame, value: newVal };
        setFame(updated);
        showToast(`Fame ${newVal}`);
        checkFameLevel(updated);
      }

      function setFameValueDirect(nv) {
        const normalized = Math.max(0, Math.floor(Number(nv) || 0));
        if (normalized === fame.value) return;
        pushHistory({ type: "fame", before: fame.value });
        const updated = { ...fame, value: normalized };
        setFame(updated);
        checkFameLevel(updated);
      }

      function checkFameLevel(fameState) {
        const reached = fameState.levels.slice().reverse().find(l => fameState.value >= l.threshold);
        if (reached) {
          setModal({ type: "level", threshold: reached.threshold, reward: reached.reward });
        }
      }

      function applyLevelReward() {
        setModal(null);
        showToast("Level reward applied");
      }

      function undo() {
        const last = history.slice(-1)[0];
        if (!last) return showToast("Nothing to undo");
        setHistory(h => h.slice(0, -1));
        if (last.type === "rep") setReputation(r => ({ ...r, value: last.before }));
        if (last.type === "fame") setFame(f => ({ ...f, value: last.before }));
        showToast("Undone");
      }

      function resetAll() {
        pushHistory({ type: "reset", beforeRep: reputation.value, beforeFame: fame.value });
        setReputation(DEFAULTS.reputation);
        setFame(DEFAULTS.fame);
        showToast("Reset");
      }

      const repFillPct = ((reputation.value - reputation.min) / (reputation.max - reputation.min)) * 100;

      return (
        <div className="phone-frame" role="application" aria-label="Mage Knight Companion">
          <header className="topbar">
            <div className="title">Mage Knight Companion</div>
            <button className="icon-btn" aria-label="settings">⚙️</button>
          </header>

          <main className="content">
            <section className="card" aria-labelledby="rep-heading">
              <div className="card-header">
                <h3 id="rep-heading">Reputation</h3>
                <div className="rep-value" aria-live="polite">{reputation.value}</div>
              </div>

              <div
                className="rep-bar"
                role="progressbar"
                aria-valuemin={reputation.min}
                aria-valuemax={reputation.max}
                aria-valuenow={reputation.value}
                aria-label="Reputation track"
              >
                <div className="rep-fill" style={{ width: `${repFillPct}%` }} />
                {reputation.markers.map((m, i) => (
                  <div
                    key={i}
                    className="rep-marker"
                    style={{ left: `${((m - reputation.min) / (reputation.max - reputation.min)) * 100}%` }}
                    aria-hidden
                  >
                    <span>{m}</span>
                  </div>
                ))}
              </div>

              <div className="controls-row">
                <button onClick={() => changeReputation(-1)} aria-label="decrease reputation">−</button>
                <button onClick={() => changeReputation(1)} aria-label="increase reputation">+</button>
                <button onClick={() => setModal({ type: "reputation-details" })}>Details</button>
              </div>
            </section>

            <section className="card" aria-labelledby="fame-heading">
              <div className="card-header">
                <h3 id="fame-heading">Fame</h3>
                <div className="fame-value" aria-live="polite">{fame.value}</div>
              </div>

              <div className="fame-controls">
                <div className="fame-step">
                  <button onClick={() => changeFame(-1)} aria-label="decrease fame">−</button>
                  <input
                    type="number"
                    value={fame.value}
                    min="0"
                    onChange={(e) => setFameValueDirect(e.target.value)}
                    aria-label="fame value"
                  />
                  <button onClick={() => changeFame(1)} aria-label="increase fame">+</button>
                </div>

                <div className="fame-presets">
                  <button onClick={() => changeFame(1)}>+1</button>
                  <button onClick={() => changeFame(5)}>+5</button>
                  <button onClick={() => changeFame(10)}>+10</button>
                </div>

                <div className="level-preview">
                  <strong>Next level</strong>
                  <span>
                    {fame.levels.find(l => l.threshold > fame.value)?.threshold ?? "—"}
                  </span>
                </div>
              </div>
            </section>

            <div className="small-controls">
              <button onClick={undo}>Undo</button>
              <button onClick={resetAll}>Reset</button>
            </div>
          </main>

          {modal && (
            <div className="modal" role="dialog" aria-modal="true">
              <div className="modal-card">
                {modal.type === "level" && (
                  <>
                    <h4>Level reached</h4>
                    <p><strong>Threshold:</strong> {modal.threshold}</p>
                    <p><strong>Reward:</strong> {modal.reward}</p>
                    <div className="modal-actions">
                      <button onClick={() => setModal(null)}>Close</button>
                      <button onClick={applyLevelReward}>Apply Reward</button>
                    </div>
                  </>
                )}
                {modal.type === "reputation-details" && (
                  <>
                    <h4>Reputation Details</h4>
                    <p><strong>Current:</strong> {reputation.value}</p>
                    <p><strong>Markers:</strong> {reputation.markers.join(", ")}</p>
                    <div className="modal-actions">
                      <button onClick={() => setModal(null)}>Close</button>
                    </div>
                  </>
                )}
              </div>
            </div>
          )}

          {toast && <div className="toast" role="status">{toast}</div>}
        </div>
      );
    }

    const rootEl = document.getElementById('root');
    ReactDOM.createRoot(rootEl).render(<App />);
  </script>
</body>
</html>
