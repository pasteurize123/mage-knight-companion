<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mage Knight Companion â€” Responsive Reputation</title>
  <style>
    :root{
      --bg:#f4f4f4;
      --panel:#ffffff;
      --track-bg:#ececec;
      --cell:#e6e6e6;
      --sel-rep:#bfe7c7;
      --sel-fame:#ffdca3;
      --gap:8px;
      --rep-min:46px; /* adjust to fit more columns on small screens */
      --fame-min:30px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:var(--bg);color:#111;padding:12px}
    h1{font-size:18px;margin:0 0 10px}
    .panel{background:var(--track-bg);border-radius:10px;padding:10px;margin-bottom:12px}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    button{padding:6px 8px;border-radius:8px;border:1px solid #ccc;background:#fff;font-size:13px}
    .output{background:var(--panel);padding:8px;border-radius:8px;min-height:40px;font-size:13px;overflow:hidden}

    /* Reputation: responsive wrapping grid so it always fits */
    .rep-grid {
      display:grid;
      gap:6px;
      grid-template-columns: repeat(auto-fit, minmax(var(--rep-min), 1fr));
      width:100%;
      align-items:center;
    }
    .rep-cell{
      background:var(--cell);
      padding:6px 4px;
      border-radius:6px;
      text-align:center;
      cursor:pointer;
      font-size:13px;
      user-select:none;
    }
    .rep-cell.selected{background:var(--sel-rep);font-weight:700}

    /* Fame input */
    .fame-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    input[type=number]{width:110px;padding:8px;border-radius:6px;border:1px solid #ccc;font-size:14px}
    .fame-result{font-weight:700;font-size:16px;padding:6px 8px;background:#fff;border-radius:6px}

    /* Fame level rows removed â€” using input only */

    /* Crystals & deck */
    .cr-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:6px;font-size:14px}
    .small{font-size:13px}
    .compact{font-size:12px;padding:5px 6px}

    @media (max-width:420px){
      :root{--rep-min:40px;--fame-min:28px}
      input[type=number]{width:88px;padding:6px}
      .fame-result{font-size:14px}
      .rep-cell{font-size:12px;padding:5px}
      button{padding:5px 6px;font-size:12px}
    }

    @media (max-width:330px){
      :root{--rep-min:34px}
      .rep-cell{font-size:11px;padding:4px}
    }

    /* info row */
    .legend{display:flex;justify-content:space-between;gap:8px;margin-top:8px;font-size:13px}
  </style>
</head>
<body>
  <h1>Mage Knight Companion</h1>

  <div class="panel" aria-labelledby="rep-title">
    <h2 id="rep-title" style="margin:6px 0 8px 0;font-size:14px">Reputation Track (tap to set)</h2>

    <!-- Responsive reputation grid: will wrap into multiple rows on narrow screens -->
    <div class="rep-grid" id="rep-grid" role="list" aria-label="Reputation slots"></div>
    <div style="margin-top:8px;text-align:right;font-size:13px">Current: <strong id="rep-display">0</strong></div>

    <hr style="border:none;height:8px;background:transparent">

    <h2 style="margin:6px 0 8px 0;font-size:14px">Fame (enter number)</h2>
    <div class="fame-row">
      <label for="fame-input" class="small" style="font-weight:600">Fame</label>
      <input id="fame-input" type="number" min="0" max="119" value="0" aria-label="Fame value" />
      <div class="fame-result" id="fame-result" aria-live="polite">Level 1</div>
      <div style="margin-left:auto;font-size:13px">Fame: <strong id="fame-display">0</strong></div>
    </div>

    <div class="legend" style="margin-top:10px">
      <div class="small">Click reputation cells to select slot</div>
      <div class="small">Fame levels: 1=0â€“2, 2=3â€“7, 3=8â€“14, 4=15â€“23, 5=24â€“34, 6=35â€“47, 7=48â€“62, 8=63â€“79, 9=80â€“98, 10=99â€“119</div>
    </div>
  </div>

  <div class="panel">
    <h2 style="margin:6px 0 8px 0;font-size:14px">Crystals</h2>
    <div class="cr-row">
      <div>ðŸ”´ Red: <strong id="red">0</strong></div>
      <div><button class="compact" onclick="changeCrystal('red',1)">+ </button><button class="compact" onclick="changeCrystal('red',-1)">âˆ’</button></div>

      <div style="width:16px"></div>

      <div>ðŸ”µ Blue: <strong id="blue">0</strong></div>
      <div><button class="compact" onclick="changeCrystal('blue',1)">+ </button><button class="compact" onclick="changeCrystal('blue',-1)">âˆ’</button></div>
    </div>

    <div class="cr-row">
      <div>ðŸŸ¢ Green: <strong id="green">0</strong></div>
      <div><button class="compact" onclick="changeCrystal('green',1)">+ </button><button class="compact" onclick="changeCrystal('green',-1)">âˆ’</button></div>

      <div style="width:16px"></div>

      <div>âšª White: <strong id="white">0</strong></div>
      <div><button class="compact" onclick="changeCrystal('white',1)">+ </button><button class="compact" onclick="changeCrystal('white',-1)">âˆ’</button></div>
    </div>
  </div>

  <div class="panel">
    <h2 style="margin:6px 0 8px 0;font-size:14px">Dummy Deck</h2>
    <div class="row" style="align-items:center">
      <div style="display:flex;gap:6px;flex-wrap:wrap">
        <button class="compact" onclick="addCard('Red')">+ Red</button>
        <button class="compact" onclick="addCard('Blue')">+ Blue</button>
        <button class="compact" onclick="addCard('Green')">+ Green</button>
        <button class="compact" onclick="addCard('White')">+ White</button>
        <button class="compact" onclick="resetDeck()">Reset</button>
        <button class="compact" onclick="reshuffleDiscardIntoDeck()">Reshuffle</button>
      </div>
      <div style="margin-left:auto;font-size:13px">Cards: <strong id="deck-count">0</strong></div>
    </div>
  </div>

  <div class="panel">
    <div class="row" style="align-items:center">
      <button onclick="drawDummyCards()">Draw Dummy Cards</button>
      <div id="dummy-output" class="output" style="flex:1;margin-left:8px">Drawn cards will appear here.</div>
    </div>
  </div>

  <div class="panel">
    <div style="font-weight:700;margin-bottom:6px">Discard Pile</div>
    <div id="discard-output" class="output">Discard pile is empty.</div>
  </div>

  <script>
    // State
    let fame = 0;
    let reputationIndex = 6; // start at middle "0" slot (index 6 of 0..14)
    let crystals = { red: 0, blue: 0, green: 0, white: 0 };
    let dummyDeck = [];
    let discardPile = [];

    // Reputation values (15 slots)
    const repValues = ["â€“X","â€“5","â€“3","â€“2","â€“1","â€“1","0","0","0","+1","+1","+2","+2","+3","+5"];

    // Fame level brackets (updated)
    const fameLevels = [
      {level:1, min:0,  max:2},
      {level:2, min:3,  max:7},
      {level:3, min:8,  max:14},
      {level:4, min:15, max:23},
      {level:5, min:24, max:34},
      {level:6, min:35, max:47},
      {level:7, min:48, max:62},
      {level:8, min:63, max:79},
      {level:9, min:80, max:98},
      {level:10,min:99, max:119}
    ];

    // DOM refs
    const repGrid = document.getElementById('rep-grid');
    const fameInput = document.getElementById('fame-input');
    const fameResult = document.getElementById('fame-result');
    const fameDisplayEl = document.getElementById('fame-display');
    const repDisplayEl = document.getElementById('rep-display');

    // Build reputation grid as a wrapping responsive grid
    function buildRepGrid() {
      repGrid.innerHTML = '';
      repValues.forEach((v, idx) => {
        const el = document.createElement('div');
        el.className = 'rep-cell';
        el.textContent = v;
        el.dataset.index = idx;
        el.addEventListener('click', () => {
          reputationIndex = idx;
          updateRepUI();
        });
        repGrid.appendChild(el);
      });
    }

    // Fame helper
    function getFameLevel(value) {
      const val = Math.max(0, Math.min(119, Math.floor(Number(value) || 0)));
      for (const b of fameLevels) if (val >= b.min && val <= b.max) return b.level;
      return 1;
    }

    function updateFameFromInput() {
      const val = Math.max(0, Math.min(119, Math.floor(Number(fameInput.value) || 0)));
      fame = val;
      const level = getFameLevel(fame);
      fameResult.textContent = `Level ${level}`;
      fameDisplayEl.textContent = fame;
    }

    function updateRepUI() {
      Array.from(repGrid.children).forEach(c => c.classList.toggle('selected', Number(c.dataset.index) === reputationIndex));
      repDisplayEl.textContent = repValues[reputationIndex];
    }

    // crystals
    function changeCrystal(color, amount) {
      crystals[color] = Math.max(0, crystals[color] + amount);
      document.getElementById(color).textContent = crystals[color];
    }

    // deck & draw
    function initializeDeck() {
      dummyDeck = [
        ...Array(4).fill("Red Card"),
        ...Array(4).fill("Blue Card"),
        ...Array(4).fill("Green Card"),
        ...Array(4).fill("White Card")
      ];
      discardPile = [];
      shuffle(dummyDeck);
      updateDeckCount();
      updateDiscardPile();
      document.getElementById('dummy-output').textContent = 'Deck initialized and shuffled.';
    }

    function shuffle(a) {
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
    }

    function addCard(color) {
      dummyDeck.push(`${color} Card`);
      updateDeckCount();
    }
    function resetDeck() { initializeDeck(); }

    function reshuffleDiscardIntoDeck() {
      if (discardPile.length === 0) return;
      dummyDeck.push(...discardPile);
      discardPile = [];
      shuffle(dummyDeck);
      updateDeckCount();
      updateDiscardPile();
    }

    function drawDummyCards() {
      const drawn = [];
      for (let i = 0; i < 3 && dummyDeck.length > 0; i++) drawn.push(dummyDeck.pop());
      const last = drawn[drawn.length - 1];
      if (last) {
        const color = last.split(' ')[0].toLowerCase();
        const extra = crystals[color] || 0;
        for (let i = 0; i < extra && dummyDeck.length > 0; i++) drawn.push(dummyDeck.pop());
      }
      if (dummyDeck.length === 0 && discardPile.length > 0) {
        const moved = discardPile.splice(0);
        dummyDeck.push(...moved);
        shuffle(dummyDeck);
      }
      discardPile.push(...drawn);
      document.getElementById('dummy-output').textContent = drawn.length === 0 ? 'No cards drawn (deck empty).' : `Dummy draws: ${drawn.join(', ')}`;
      updateDeckCount();
      updateDiscardPile();
    }

    function updateDeckCount() { document.getElementById('deck-count').textContent = dummyDeck.length; }
    function updateDiscardPile() { document.getElementById('discard-output').textContent = discardPile.length === 0 ? 'Discard pile is empty.' : `Discard pile (${discardPile.length}): ${discardPile.join(', ')}`; }

    // Init
    fameInput.addEventListener('input', updateFameFromInput);
    window.addEventListener('load', () => {
      buildRepGrid();
      initializeDeck();
      // start with middle rep slot (index 6) selected
      reputationIndex = 6;
      setTimeout(() => { updateRepUI(); updateFameFromInput(); }, 40);
    });

    // Expose functions used by buttons
    window.changeCrystal = changeCrystal;
    window.addCard = addCard;
    window.resetDeck = resetDeck;
    window.drawDummyCards = drawDummyCards;
    window.reshuffleDiscardIntoDeck = reshuffleDiscardIntoDeck;
  </script>
</body>
</html>
