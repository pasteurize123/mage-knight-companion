<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mage Knight Companion â€” Mobile No Scroll</title>
  <style>
    :root{
      --bg:#f4f4f4;
      --panel:#ffffff;
      --track-bg:#ececec;
      --cell:#e6e6e6;
      --sel-fame:#ffdca3;
      --sel-rep:#bfe7c7;
      --gutter:8px;
      --cell-min:30px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:var(--bg);color:#111;padding:12px}
    h1{font-size:18px;margin:0 0 10px}
    h2{font-size:15px;margin:8px 0}
    .panel{background:var(--track-bg);border-radius:10px;padding:10px;margin-bottom:12px}
    .section-title{margin:6px 0;font-weight:600}
    .row{display:flex;gap:var(--gutter);align-items:center;flex-wrap:wrap}
    .controls{display:flex;gap:6px;flex-wrap:wrap}
    button{padding:6px 8px;border-radius:8px;border:1px solid #ccc;background:#fff;font-size:13px}
    .small{font-size:13px}
    .output{background:var(--panel);padding:8px;border-radius:8px;min-height:40px;font-size:13px}

    /* Reputation */
    .rep-grid{display:grid;grid-auto-flow:column;gap:6px;align-items:center}
    .rep-cell{min-width:40px;padding:6px;background:var(--cell);border-radius:6px;text-align:center;cursor:pointer;font-size:12px}
    .rep-cell.selected{background:var(--sel-rep)}

    /* Fame levels: each level is a responsive grid that wraps */
    .levels{display:flex;flex-direction:column;gap:10px}
    .level-row{display:flex;gap:10px;align-items:flex-start;flex-wrap:wrap}
    .level-label{min-width:72px;font-weight:700;font-size:13px;flex:0 0 auto}
    .fame-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(var(--cell-min), 1fr));
      gap:6px;
      flex:1 1 auto;
    }
    .fame-cell{background:var(--cell);padding:6px;border-radius:6px;text-align:center;cursor:pointer;font-size:12px;user-select:none}
    .fame-cell.selected{background:var(--sel-fame)}

    /* compact on very small screens */
    @media (max-width:360px){
      :root{--cell-min:28px}
      .level-label{min-width:58px;font-size:12px}
      .rep-cell{min-width:36px;padding:5px;font-size:11px}
      button{padding:5px 6px;font-size:12px}
    }

    /* info row */
    .legend{display:flex;justify-content:space-between;gap:8px;margin-top:8px;font-size:13px}
    .legend div{flex:0 0 auto}
  </style>
</head>
<body>
  <h1>Mage Knight Companion</h1>

  <div class="panel" aria-labelledby="rep-title">
    <h2 id="rep-title" class="section-title">Reputation Track</h2>
    <div class="row" style="align-items:center">
      <div class="rep-grid" id="rep-grid" role="list"></div>
      <div style="margin-left:auto;text-align:right;font-size:13px">Current: <strong id="rep-display">0</strong></div>
    </div>

    <h2 class="section-title" style="margin-top:12px">Fame Track (by Level)</h2>
    <div class="levels" id="levels-container"></div>

    <div class="legend">
      <div>Fame Level: <strong id="fame-level">1</strong></div>
      <div>Fame: <strong id="fame-display">0</strong></div>
    </div>
  </div>

  <div class="panel">
    <h2 class="section-title">Crystals</h2>
    <div class="row" style="gap:12px">
      <div style="font-size:14px">ðŸ”´ Red: <strong id="red">0</strong></div>
      <div class="controls"><button onclick="changeCrystal('red',1)">+ </button><button onclick="changeCrystal('red',-1)">âˆ’</button></div>
      <div style="width:8px"></div>
      <div style="font-size:14px">ðŸ”µ Blue: <strong id="blue">0</strong></div>
      <div class="controls"><button onclick="changeCrystal('blue',1)">+ </button><button onclick="changeCrystal('blue',-1)">âˆ’</button></div>
    </div>
    <div style="height:8px"></div>
    <div class="row" style="gap:12px">
      <div style="font-size:14px">ðŸŸ¢ Green: <strong id="green">0</strong></div>
      <div class="controls"><button onclick="changeCrystal('green',1)">+ </button><button onclick="changeCrystal('green',-1)">âˆ’</button></div>
      <div style="width:8px"></div>
      <div style="font-size:14px">âšª White: <strong id="white">0</strong></div>
      <div class="controls"><button onclick="changeCrystal('white',1)">+ </button><button onclick="changeCrystal('white',-1)">âˆ’</button></div>
    </div>
  </div>

  <div class="panel">
    <h2 class="section-title">Dummy Deck</h2>
    <div class="row" style="align-items:center">
      <div class="controls" style="flex-wrap:wrap">
        <button onclick="addCard('Red')">+ Red</button>
        <button onclick="addCard('Blue')">+ Blue</button>
        <button onclick="addCard('Green')">+ Green</button>
        <button onclick="addCard('White')">+ White</button>
        <button onclick="resetDeck()">Reset</button>
        <button onclick="reshuffleDiscardIntoDeck()">Reshuffle</button>
      </div>
      <div style="margin-left:auto;font-size:13px">Cards: <strong id="deck-count">0</strong></div>
    </div>
  </div>

  <div class="panel">
    <h2 class="section-title">Draw</h2>
    <div class="row" style="align-items:center">
      <button onclick="drawDummyCards()">Draw Dummy Cards</button>
      <div id="dummy-output" class="output" style="flex:1;margin-left:8px">Drawn cards will appear here.</div>
    </div>
  </div>

  <div class="panel">
    <h2 class="section-title">Discard Pile</h2>
    <div id="discard-output" class="output">Discard pile is empty.</div>
  </div>

  <script>
    // State
    let fame = 0;
    let reputationIndex = 7; // middle (0)
    let crystals = { red:0, blue:0, green:0, white:0 };
    let dummyDeck = [];
    let discardPile = [];

    // Rep values
    const repValues = ["â€“X","â€“5","â€“3","â€“2","â€“1","â€“1","0","0","0","+1","+1","+2","+2","+3","+5"];

    // Fame brackets (Level 7 = 48-62)
    const fameLevels = [
      {level:1, min:0,  max:2},
      {level:2, min:3,  max:7},
      {level:3, min:8,  max:14},
      {level:4, min:15, max:23},
      {level:5, min:24, max:34},
      {level:6, min:35, max:47},
      {level:7, min:48, max:62},
      {level:8, min:63, max:79},
      {level:9, min:80, max:98},
      {level:10,min:99, max:119}
    ];

    // DOM refs
    const repGrid = document.getElementById('rep-grid');
    const levelsContainer = document.getElementById('levels-container');
    const fameLevelEl = document.getElementById('fame-level');
    const fameDisplayEl = document.getElementById('fame-display');
    const repDisplayEl = document.getElementById('rep-display');

    // Build reputation UI (clickable)
    repValues.forEach((v, idx) => {
      const c = document.createElement('div');
      c.className = 'rep-cell';
      c.textContent = v;
      c.dataset.index = idx;
      c.addEventListener('click', () => { reputationIndex = idx; updateRepUI(); });
      repGrid.appendChild(c);
    });

    // Build fame level grids (responsive wrap)
    const fameCellRefs = [];
    fameLevels.forEach((lvl, li) => {
      const row = document.createElement('div');
      row.className = 'level-row';

      const label = document.createElement('div');
      label.className = 'level-label';
      label.textContent = `Level ${lvl.level}`;
      row.appendChild(label);

      const grid = document.createElement('div');
      grid.className = 'fame-grid';
      grid.setAttribute('role','list');

      for (let v = lvl.min; v <= lvl.max; v++){
        const cell = document.createElement('div');
        cell.className = 'fame-cell';
        cell.textContent = v;
        cell.dataset.value = v;
        cell.addEventListener('click', () => { fame = v; updateFameUI(); });
        grid.appendChild(cell);
        fameCellRefs.push({levelIndex:li, value:v, el:cell});
      }

      row.appendChild(grid);
      levelsContainer.appendChild(row);
    });

    function locateFame(value){
      value = Math.max(0, Math.min(119, value));
      for (let i=0;i<fameLevels.length;i++){
        const lvl = fameLevels[i];
        if (value >= lvl.min && value <= lvl.max) return {levelIndex:i, level:lvl.level, min:lvl.min, max:lvl.max};
      }
      return {levelIndex:0, level:1};
    }

    function updateFameUI(){
      fameCellRefs.forEach(r => r.el.classList.toggle('selected', r.value === fame));
      const loc = locateFame(fame);
      fameLevelEl.textContent = loc.level;
      fameDisplayEl.textContent = fame;
      // no horizontal scroll required; cells wrap to fit width
    }

    function updateRepUI(){
      Array.from(repGrid.children).forEach(c => c.classList.toggle('selected', Number(c.dataset.index) === reputationIndex));
      repDisplayEl.textContent = repValues[reputationIndex];
    }

    // crystals
    function changeCrystal(color, amount){
      crystals[color] = Math.max(0, crystals[color] + amount);
      document.getElementById(color).textContent = crystals[color];
    }

    // deck & draw
    function initializeDeck(){
      dummyDeck = [...Array(4).fill("Red Card"), ...Array(4).fill("Blue Card"), ...Array(4).fill("Green Card"), ...Array(4).fill("White Card")];
      discardPile = [];
      shuffle(dummyDeck);
      updateDeckCount();
      updateDiscardPile();
      document.getElementById('dummy-output').textContent = 'Deck initialized and shuffled.';
    }
    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j = Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }
    function addCard(color){ dummyDeck.push(color + ' Card'); updateDeckCount(); }
    function resetDeck(){ initializeDeck(); }
    function reshuffleDiscardIntoDeck(){ if (discardPile.length===0){ alert('Discard empty'); return; } dummyDeck.push(...discardPile); discardPile=[]; shuffle(dummyDeck); updateDeckCount(); updateDiscardPile(); }

    function drawDummyCards(){
      const drawn = [];
      for (let i=0;i<3 && dummyDeck.length>0;i++) drawn.push(dummyDeck.pop());
      const last = drawn[drawn.length-1];
      if (last){
        const color = last.split(' ')[0].toLowerCase();
        const extra = crystals[color] || 0;
        for (let i=0;i<extra && dummyDeck.length>0;i++) drawn.push(dummyDeck.pop());
      }
      if (dummyDeck.length===0 && discardPile.length>0){
        const moved = discardPile.splice(0);
        dummyDeck.push(...moved);
        shuffle(dummyDeck);
      }
      discardPile.push(...drawn);
      document.getElementById('dummy-output').textContent = drawn.length===0 ? 'No cards drawn (deck empty).' : `Dummy draws: ${drawn.join(', ')}`;
      updateDeckCount();
      updateDiscardPile();
    }

    function updateDeckCount(){ document.getElementById('deck-count').textContent = dummyDeck.length; }
    function updateDiscardPile(){ document.getElementById('discard-output').textContent = discardPile.length===0 ? 'Discard pile is empty.' : `Discard pile (${discardPile.length}): ${discardPile.join(', ')}`; }

    // init
    window.addEventListener('load', () => {
      initializeDeck();
      setTimeout(()=>{ updateFameUI(); updateRepUI(); }, 60);
    });

    // expose some functions for buttons
    window.changeCrystal = changeCrystal;
    window.addCard = addCard;
    window.resetDeck = resetDeck;
    window.drawDummyCards = drawDummyCards;
    window.reshuffleDiscardIntoDeck = reshuffleDiscardIntoDeck;
  </script>
</body>
</html>
