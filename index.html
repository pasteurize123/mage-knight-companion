<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Mage Knight Companion â€” GV spell S overlay</title>
<style>
  :root{
    --bg:#f4f4f4; --panel:#ececec; --card:#fff; --muted:#666;
    --accent:#b00020; --pill:#f7f7f7;
    --font:system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  }
  *{box-sizing:border-box}
  body{margin:12px;font-family:var(--font);background:var(--bg);color:#111}
  h1{font-size:18px;text-align:center;margin:0 0 12px}
  .container{max-width:980px;margin:0 auto;display:flex;flex-direction:column;gap:12px}
  .panel{background:var(--panel);border-radius:10px;padding:10px}
  .panel-inner{background:var(--card);border-radius:8px;padding:12px;display:flex;flex-direction:column;gap:10px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .smallbtn{padding:6px 10px;border-radius:6px;border:1px solid #ccc;background:#fff;cursor:pointer}
  .output{background:#fff;padding:8px;border-radius:6px;min-height:36px}
  .gv-pile{display:flex;gap:6px;flex-wrap:wrap}
  .gv-pill{background:var(--pill);border-radius:6px;padding:6px 8px;border:1px solid #ddd;font-weight:600}

  /* wound pill */
  .wound-box{display:flex;flex-direction:column;align-items:center;gap:4px;padding:6px;border-radius:6px;background:#fff;border:1px solid #eee;min-width:46px}
  .wound-num{font-weight:700}
  .wound-symbol{font-size:1.2rem;color:var(--accent)}

  /* Spell symbol with S overlay */
  .symbol {
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:28px;
    height:28px;
    font-size:18px;
    position:relative;
    line-height:1;
    border-radius:50%;
    background:transparent;
  }
  .symbol.spell::after{
    content:'S';
    position:absolute;
    top:-7px;
    right:-8px;
    width:18px;
    height:18px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    font-size:12px;
    font-weight:700;
    color:#fff;
    background:rgba(0,0,0,0.65);
    border-radius:10px;
    box-shadow:0 1px 2px rgba(0,0,0,0.2);
  }

  .symbol-pill{display:inline-flex;gap:6px;align-items:center;padding:6px;border-radius:6px;background:var(--pill);border:1px solid #ddd}
  .gv-desc{color:var(--accent);font-size:0.92rem;margin-top:6px;display:none}
  @media (max-width:700px){ .symbol{width:24px;height:24px;font-size:16px} .symbol.spell::after{top:-6px;right:-6px;width:16px;height:16px;font-size:11px} }
</style>
</head>
<body>
  <h1>Mage Knight Companion</h1>

  <div class="container">
    <section class="panel">
      <div class="panel-inner">
        <h2 style="margin:0;font-size:16px">General Volkare</h2>

        <div class="row" style="gap:18px;margin-top:6px">
          <div style="flex:1">
            <div style="display:flex;flex-direction:column;gap:8px">
              <div class="gv-pile">
                <div class="gv-pill">Advanced Actions</div>
                <div class="gv-pill symbol-pill">
                  <span class="symbol">ðŸ”´</span><span class="symbol">ðŸ”´</span><span class="symbol">ðŸ”´</span><span class="symbol">ðŸ”´</span>
                </div>
                <div class="gv-pill symbol-pill">
                  <span class="symbol">ðŸ”µ</span><span class="symbol">ðŸ”µ</span><span class="symbol">ðŸ”µ</span><span class="symbol">ðŸ”µ</span>
                </div>
                <div class="gv-pill symbol-pill">
                  <span class="symbol">ðŸŸ¢</span><span class="symbol">ðŸŸ¢</span><span class="symbol">ðŸŸ¢</span><span class="symbol">ðŸŸ¢</span>
                </div>
                <div class="gv-pill symbol-pill">
                  <span class="symbol">âšª</span><span class="symbol">âšª</span><span class="symbol">âšª</span><span class="symbol">âšª</span>
                </div>
              </div>

              <div class="gv-pile">
                <div class="gv-pill">Spells</div>
                <div class="gv-pill symbol-pill">
                  <span class="symbol spell">ðŸ”´</span>
                  <span class="symbol spell">ðŸ”µ</span>
                  <span class="symbol spell">ðŸŸ¢</span>
                  <span class="symbol spell">âšª</span>
                </div>
              </div>

              <div style="display:flex;align-items:center;gap:12px">
                <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-start">
                  <div style="font-weight:600">Wounds</div>
                  <div class="wound-box" aria-live="polite">
                    <div class="wound-num"><strong id="gv-wounds">0</strong></div>
                    <div class="wound-symbol">ðŸ©¸</div>
                  </div>
                </div>

                <div style="display:flex;gap:8px;align-items:center">
                  <button class="smallbtn gv-wound-btn" data-act="dec">âˆ’</button>
                  <button class="smallbtn gv-wound-btn" data-act="inc">+</button>
                </div>

                <div style="margin-left:16px;color:var(--muted)">Deck size: <strong id="deck-count-gv">0</strong></div>
              </div>

              <div id="gv-frenzy-desc" class="gv-desc" aria-live="polite">Frenzy â€” Volkare will act as if a spell was drawn.</div>
            </div>
          </div>

          <div style="flex:1">
            <div style="display:flex;flex-direction:column;gap:10px">
              <div style="font-weight:600">Controls</div>
              <div style="display:flex;gap:8px">
                <button id="draw-btn-gv" class="smallbtn">Draw</button>
                <button id="reshuffle-btn-gv" class="smallbtn">Reshuffle Deck</button>
              </div>
            </div>
          </div>
        </div>

        <div style="margin-top:10px">
          <div id="dummy-output-gv" class="output">Drawn cards appear here (symbols)</div>
        </div>

        <div style="margin-top:8px">
          <div id="discard-output-gv" class="output">Discard pile is empty.</div>
        </div>
      </div>
    </section>

    <footer style="display:flex;justify-content:center">
      <button id="new-game" class="smallbtn">New Game</button>
    </footer>
  </div>

<script>
/* Minimal module implementing:
   - Spell symbols show an "S" overlay (CSS .symbol.spell::after)
   - GV draws 1 card
   - Wounds are Wound cards shown as ðŸ©¸ and count displayed under number
   - New Game resets GV deck and wounds */

const STORAGE_KEY = 'mk_gv_spellS_v1';
const SYMBOL = { Red:'ðŸ”´', Blue:'ðŸ”µ', Green:'ðŸŸ¢', White:'âšª', Wound:'ðŸ©¸' };

function GVModule(){
  const ids = {
    deckCount: 'deck-count-gv',
    drawBtn: 'draw-btn-gv',
    dummyOutput: 'dummy-output-gv',
    discardOutput: 'discard-output-gv',
    reshuffleBtn: 'reshuffle-btn-gv',
    gvWounds: 'gv-wounds',
    gvFrenzyDesc: 'gv-frenzy-desc'
  };
  let deck = [];
  let discard = [];
  let wounds = 0;
  const SKEY = STORAGE_KEY;

  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }
  function el(id){ return document.getElementById(id); }

  function buildDefaultDeck(){
    deck = [];
    ['Red','Blue','Green','White'].forEach(c=>{ for(let i=0;i<4;i++) deck.push(`Adv-${c}`); });
    ['Red','Blue','Green','White'].forEach(c=> deck.push(`Spell-${c}`));
    shuffle(deck);
    wounds = 0;
    save(); updateCounts(); updateDrawButtonState();
  }

  function save(){ try{ localStorage.setItem(SKEY, JSON.stringify({deck,discard,wounds})); }catch(e){} }
  function load(){ try{ const raw = localStorage.getItem(SKEY); if(!raw) return false; const s=JSON.parse(raw); deck = Array.isArray(s.deck)?s.deck:deck; discard = Array.isArray(s.discard)?s.discard:discard; wounds = typeof s.wounds==='number'?s.wounds:wounds; updateCounts(); updateDrawButtonState(); return true; }catch(e){ return false; } }

  function displayGVCard(code){
    if(!code) return '';
    if(code.startsWith('Adv-')) return SYMBOL[code.split('-')[1]] || code;
    if(code.startsWith('Spell-')) {
      // return a span-like textual representation: S+symbol for display area
      return 'S' + (SYMBOL[code.split('-')[1]] || code);
    }
    if(code === 'Wound') return SYMBOL.Wound;
    return code;
  }

  function updateCounts(){
    if(el(ids.deckCount)) el(ids.deckCount).textContent = deck.length;
    if(el(ids.gvWounds)) el(ids.gvWounds).textContent = wounds;
    if(el(ids.discardOutput)) el(ids.discardOutput).textContent = discard.length===0 ? 'Discard pile is empty.' : `Discard (${discard.length}): ${discard.map(displayGVCard).join(' ')}`;
  }

  function changeWounds(delta){
    const newW = Math.max(0, wounds + delta);
    const diff = newW - wounds;
    wounds = newW;
    if(diff > 0){
      for(let i=0;i<diff;i++){
        const pos = Math.floor(Math.random()*(deck.length+1));
        deck.splice(pos,0,'Wound');
      }
    } else if(diff < 0){
      let toRemove = -diff;
      while(toRemove>0){
        const idx = deck.indexOf('Wound');
        if(idx !== -1){ deck.splice(idx,1); toRemove--; continue; }
        const dj = discard.indexOf('Wound');
        if(dj !== -1){ discard.splice(dj,1); toRemove--; continue; }
        break;
      }
    }
    updateCounts(); save(); updateDrawButtonState();
  }

  function drawOnce(){
    if(deck.length === 0){
      updateDrawButtonState();
      const out = el(ids.dummyOutput); if(out) out.textContent = 'Deck empty â€” Frenzy ready. Volkare will act as if a spell was drawn.';
      return;
    }
    const card = deck.pop();
    discard.push(card);
    const out = el(ids.dummyOutput);
    if(out) {
      if(card.startsWith('Spell-')){
        // render S overlay visually in the single-line output: create S+emoji
        out.innerHTML = `<span class="symbol spell">${SYMBOL[card.split('-')[1]]}</span>`;
      } else if(card === 'Wound'){
        out.innerHTML = `<span class="wound-symbol">${SYMBOL.Wound}</span>`;
      } else {
        out.textContent = SYMBOL[card.split('-')[1]] || card;
      }
    }
    updateCounts(); save(); updateDrawButtonState();
  }

  function reshuffle(){
    if(discard.length === 0){
      const out = el(ids.dummyOutput); if(out) out.textContent = 'Discard pile is empty. Nothing to reshuffle.'; return;
    }
    deck.push(...discard); discard = []; shuffle(deck); updateCounts(); const out = el(ids.dummyOutput); if(out) out.textContent = 'Deck reshuffled from discard.'; save();
    updateDrawButtonState();
  }

  function addCardToDiscard(cardCode){
    discard.push(cardCode);
    updateCounts(); save(); updateDrawButtonState();
  }

  function updateDrawButtonState(){
    const btn = el(ids.drawBtn);
    const desc = el(ids.gvFrenzyDesc);
    if(!btn) return;
    if(deck.length === 0){
      btn.textContent = 'Frenzy';
      if(desc) desc.style.display = 'block';
    } else {
      btn.textContent = 'Draw';
      if(desc) desc.style.display = 'none';
    }
  }

  function wire(){
    const drawBtn = el(ids.drawBtn);
    if(drawBtn) drawBtn.addEventListener('click', ()=>{ if(deck.length === 0){ const out = el(ids.dummyOutput); if(out) out.textContent = 'Frenzy â€” Volkare will act as if a spell was drawn.'; return; } drawOnce(); });
    const reshuffleBtn = el(ids.reshuffleBtn); if(reshuffleBtn) reshuffleBtn.addEventListener('click', reshuffle);
    document.querySelectorAll('.gv-wound-btn').forEach(b=> b.addEventListener('click', ()=>{ const act=b.dataset.act; changeWounds(act==='inc'?1:-1); }));
  }

  return { load, save, wire, buildDefaultDeck, updateCounts, drawOnce, reshuffle, addCardToDiscard, updateDrawButtonState, changeWounds };
}

/* Init */
const gv = GVModule();
window.addEventListener('load', ()=>{
  gv.load();
  gv.wire();
  if(!document.getElementById('deck-count-gv').textContent || Number(document.getElementById('deck-count-gv').textContent)===0){
    gv.buildDefaultDeck();
  }
  gv.updateCounts();
  gv.updateDrawButtonState();

  document.getElementById('new-game').addEventListener('click', ()=>{
    if(!confirm('Start a new game? This will reset Volkare to its base deck and wounds to 0.')) return;
    localStorage.removeItem(STORAGE_KEY);
    gv.buildDefaultDeck(); // resets deck & wounds
    gv.updateCounts();
    gv.updateDrawButtonState();
    // clear display areas
    const out = document.getElementById('dummy-output-gv'); if(out) out.textContent = 'Drawn cards appear here (symbols)';
    const dOut = document.getElementById('discard-output-gv'); if(dOut) dOut.textContent = 'Discard pile is empty.';
  });
});
</script>
</body>
</html>
